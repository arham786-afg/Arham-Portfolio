---
import MainLayout from "../layouts/MainLayout.astro";
---

<MainLayout title="PS C:\\IR\\Live :: MOHAMMED BILAAL ARHAM">

<section class="system">

  <!-- Background -->
  <div class="bg kali"></div>

  <!-- System bar -->
  <div class="sysbar">
    <span class="dot"></span>
    <span>LIVE</span>
    <span>| OPERATOR: MOHAMMED BILAAL ARHAM</span>
    <span>| MODE: INCIDENT / AUTOMATION / HUNT</span>
    <span id="clock"></span>
  </div>

  <!-- PowerShell Console -->
  <div class="console">
    <div class="console-header">
      <span class="title">Windows PowerShell</span>
      <div class="controls">
        <span></span><span></span><span></span>
      </div>
    </div>

    <div class="console-body" id="console"></div>
  </div>

  <!-- Command Hub -->
<div class="hub">
  <a href="/query" class="exec">
    <span class="prompt">PS C:\IR\Live&gt;</span>
    <span class="command">Enter-QueryMode</span>
    <span class="cursor">▌</span>
  </a>
</div>



</section>

<script>
const consoleEl = document.getElementById("console");

const responses = {
  help: [
    "Available commands:",
    "  whoami              - display operator",
    "  pwd                 - Job role and profile",
    "  skills              - list operational focus",
    "  ls                  - list available modules",
    "  Enter-QueryMode     - arm query mode",
    "  clear               - clear console"
  ],
  whoami: [
    "mohammed.bilaal.arham"
  ],
  pwd: [
  " Eli Lilly and Compony",
  "/opt/ir/automation/high-severity",
  "ROLE=Security Engineer",
  "FOCUS=Incident Response / Automation / Threat Hunting"
  ],
  skills: [
    "Incident Response (CRITICAL / HIGH)",
    "Security Automation",
    "Threat Hunting",
    "SIEM & Detection Engineering",
    "Response Orchestration"
  ],
  ls: [
    "incident_response/",
    "security_automation/",
    "threat_hunting/",
    "siem_engineering/"
  ],
  "Enter-QueryMode": [
    "[+] Query mode armed",
    "[+] Context switch available"
  ]
};

let history = [];
let historyIndex = -1;

function printOutput(lines, isError = false) {
  lines.forEach(text => {
    const out = document.createElement("div");
    out.className = "output" + (isError ? " error" : "");
    out.textContent = text;
    consoleEl.appendChild(out);
  });
}

function newPrompt() {
  const line = document.createElement("div");
  line.className = "line";
  line.innerHTML = `
    <span class="prompt">PS C:\\IR\\Live&gt;</span>
    <span class="input" contenteditable="true"></span>
    <span class="cursor">▌</span>
  `;
  consoleEl.appendChild(line);

  const input = line.querySelector(".input");
  input.focus();
  historyIndex = history.length;

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      const cmd = input.textContent.trim();
      input.contentEditable = "false";
      if (cmd) history.push(cmd);
      handleCommand(cmd);
    }

    if (e.key === "ArrowUp") {
      e.preventDefault();
      if (historyIndex > 0) {
        historyIndex--;
        input.textContent = history[historyIndex];
        placeCursorAtEnd(input);
      }
    }

    if (e.key === "ArrowDown") {
      e.preventDefault();
      if (historyIndex < history.length - 1) {
        historyIndex++;
        input.textContent = history[historyIndex];
      } else {
        historyIndex = history.length;
        input.textContent = "";
      }
      placeCursorAtEnd(input);
    }
    if (e.key === "Tab") {
        e.preventDefault();

        const current = input.textContent.trim();
        if (!current) return;

        const commands = Object.keys(responses);
        const matches = commands.filter(c =>
            c.toLowerCase().startsWith(current.toLowerCase())
        );

        if (matches.length === 1) {
            input.textContent = matches[0];
            placeCursorAtEnd(input);
        }
    }
  });

  consoleEl.scrollTop = consoleEl.scrollHeight;
}

function placeCursorAtEnd(el) {
  const range = document.createRange();
  range.selectNodeContents(el);
  range.collapse(false);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

function handleCommand(cmd) {
  if (cmd === "clear") {
    consoleEl.innerHTML = "";
    newPrompt();
    return;
  }

  if (cmd === "Enter-QueryMode") {
    printOutput([
      "[+] Query mode armed",
      "[+] Switching context..."
    ]);

    setTimeout(() => {
      window.location.href = "/query";
    }, 900);

    return;
  }

  const output = responses[cmd];

  if (output) {
    printOutput(output);
  } else if (cmd) {
    printOutput(
      [`'${cmd}' is not recognized as an internal or external command.`],
      true
    );
  }

  newPrompt();
}

/* ===== BOOT SEQUENCE ===== */

// Print help ONCE at startup
printOutput(responses.help);

// Start first prompt
newPrompt();
</script>



<style>
.system {
  position: relative;
  height: 100vh;
  background: #020617;
  overflow: hidden;
}

.bg.kali {
  position: absolute;
  inset: -5%;
  background: url("/images/kali.jpg") center/cover no-repeat;
  opacity: 0.22;
  animation: drift 120s linear infinite;
}

@keyframes drift {
  to { transform: translate(-40px, -30px); }
}

.sysbar {
  position: relative;
  z-index: 5;
  padding: 0.7rem 1rem;
  font-size: 0.7rem;
  color: #9ca3af;
  display: flex;
  gap: 0.6rem;
  align-items: center;
}

.dot {
  width: 8px;
  height: 8px;
  background: #22c55e;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  50% { opacity: 0.4; }
}

.console {
  position: absolute;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  width: 720px;
  height: 420px;
  background: #020617;
  border: 1px solid #1f2937;
  box-shadow: 0 0 40px rgba(0,0,0,0.6);
  font-family: Consolas, monospace;
  z-index: 4;
}

.console-header {
  height: 28px;
  background: #020617;
  border-bottom: 1px solid #1f2937;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 0.6rem;
  font-size: 0.7rem;
  color: #9ca3af;
}

.controls span {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #374151;
  margin-left: 4px;
}

.console-body {
  padding: 0.8rem;
  font-size: 0.75rem;
  color: #22d3ee;
  height: calc(100% - 28px);
  overflow: hidden;
}

.prompt {
  color: #60a5fa;
}

.cursor {
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { opacity: 0; }
}

.output {
  margin-left: 1rem;
  color: #9ca3af;
}

.hub {
  position: absolute;
  bottom: 120px;
  left: 50%;
  transform: translateX(-50%);
  display: grid;
  gap: 1rem;
  z-index: 5;
}
.cmd {
  position: relative;
}

.cmd::after {
  content: "";
  position: absolute;
  inset: 0;
  background: currentColor;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.cmd:active::after {
  opacity: 0.15;
}

body {
  animation: pageIn 0.6s ease forwards;
}

@keyframes pageIn {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.exec {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  font-family: Consolas, monospace;
  font-size: 0.9rem;
  padding: 0.9rem 1.6rem;
  background: rgba(2,6,23,0.9);
  border: 1px solid #1f2937;
  text-decoration: none;
  color: #22d3ee;
  letter-spacing: 0.05em;
  position: relative;
  transition: box-shadow 0.2s ease, transform 0.2s ease;
}

.exec:hover {
  transform: scale(1.06);
  box-shadow:
    0 0 18px rgba(34,211,238,0.4),
    inset 0 0 12px rgba(34,211,238,0.15);
}

.exec::before {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.02),
    rgba(255,255,255,0.02) 1px,
    transparent 1px,
    transparent 3px
  );
  opacity: 0.15;
  pointer-events: none;
}

.prompt {
  color: #60a5fa;
}

.command {
  color: #22d3ee;
}

.cursor {
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { opacity: 0; }
}

.input {
  outline: none;
  min-width: 1ch;
}

.output.error {
  color: #ef4444;
}
